<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.json" />
  <title>Roulette Monitor Pro (PWA)</title>
  <style>
    :root{
      --bg:#050814;
      --panel:#0b1220;
      --panel2:#0f1b2f;
      --text:#e7eefc;
      --muted:#9fb0d0;
      --line:rgba(255,255,255,.08);
      --cyan:rgba(0,255,255,.85);
      --cyan2:rgba(0,255,255,.22);
      --good:#00ff99;
      --warn:#ffcc00;
      --bad:#ff4d4d;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:radial-gradient(1200px 600px at 50% 0%, rgba(0,255,255,.06), transparent 55%), var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
    }
    header{
      padding:14px 14px 10px;
      background:linear-gradient(180deg, rgba(11,18,32,.95), rgba(11,18,32,.8));
      border-bottom:1px solid var(--line);
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .brand .dot{
      width:14px; height:14px; border-radius:5px;
      background:linear-gradient(135deg, rgba(0,255,255,.9), rgba(140,120,255,.8));
      box-shadow:0 0 26px rgba(0,255,255,.25);
    }
    .sub{
      color:var(--muted);
      margin-top:4px;
      font-size:13px;
    }

    .wrap{max-width:1100px;margin:0 auto;padding:14px;}
    .card{
      background:linear-gradient(180deg, rgba(11,18,32,.95), rgba(11,18,32,.78));
      border:1px solid rgba(0,255,255,.12);
      border-radius:18px;
      padding:14px;
      box-shadow:0 18px 50px rgba(0,0,0,.35);
    }
    .card + .card{margin-top:14px;}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;}
    .row.space{justify-content:space-between;}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(0,255,255,.25);
      background:rgba(15,27,47,.7);
      color:var(--text);
    }
    .btn{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,27,47,.78);
      color:var(--text);
      cursor:pointer;
      font-weight:650;
      letter-spacing:.2px;
    }
    .btn:hover{border-color:rgba(0,255,255,.35)}
    .btn.primary{
      border-color:rgba(0,255,255,.35);
      background:linear-gradient(180deg, rgba(0,255,255,.12), rgba(15,27,47,.75));
      box-shadow:0 0 0 2px rgba(0,255,255,.06) inset;
    }
    .btn.ghost{
      background:transparent;
      border-color:rgba(255,255,255,.10);
    }
    .btn.danger{
      border-color:rgba(255,77,77,.35);
      background:linear-gradient(180deg, rgba(255,77,77,.10), rgba(15,27,47,.78));
    }
    .btn.small{padding:8px 10px;border-radius:12px;font-size:13px}
    .btn:disabled{opacity:.55; cursor:not-allowed}

    .title{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      margin-bottom:10px;
    }
    .title .icon{
      width:22px;height:22px;border-radius:7px;
      border:1px solid rgba(0,255,255,.22);
      background:rgba(0,255,255,.06);
      display:flex;align-items:center;justify-content:center;
      font-size:13px;
    }

    .tabs{display:flex;gap:10px;flex-wrap:wrap}
    .tab{
      padding:10px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,27,47,.55);
      color:var(--text);
      cursor:pointer;
      font-weight:700;
      user-select:none;
    }
    .tab.active{
      border-color:rgba(0,255,255,.35);
      background:linear-gradient(180deg, rgba(0,255,255,.12), rgba(15,27,47,.55));
      box-shadow:0 0 22px rgba(0,255,255,.08);
    }

    .controls{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      margin-top:10px;
    }
    .slider{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,27,47,.55);
    }
    input[type="range"]{width:160px}
    .kpiGrid{
      display:grid;
      grid-template-columns:repeat(4, minmax(0,1fr));
      gap:10px;
      margin-top:12px;
    }
    @media (max-width:900px){
      .kpiGrid{grid-template-columns:repeat(2, minmax(0,1fr));}
      input[type="range"]{width:140px}
    }
    .kpi{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(15,27,47,.45);
    }
    .kpi .k{color:var(--muted);font-size:12px}
    .kpi .v{font-size:18px;font-weight:800;margin-top:6px}
    .kpi .s{font-size:12px;color:var(--muted);margin-top:6px;min-height:14px}

    .grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width:900px){ .grid2{grid-template-columns:1fr;} }

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(0,255,255,.18);
      background:rgba(0,255,255,.06);
      color:var(--text);
      font-weight:750;
      font-size:13px;
    }

    .heat{
      display:grid;
      grid-template-columns:repeat(12, minmax(0,1fr));
      gap:6px;
      margin-top:10px;
    }
    @media (max-width:900px){ .heat{grid-template-columns:repeat(9, minmax(0,1fr));} }
    .cell{
      padding:8px 0;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(15,27,47,.45);
      text-align:center;
      font-weight:800;
      position:relative;
      overflow:hidden;
    }
    .cell small{display:block;color:var(--muted);font-weight:700;margin-top:2px;font-size:11px}
    .bar{
      position:absolute; inset:auto 0 0 0;
      height:4px; background:rgba(0,255,255,.35);
    }

    .lastRow{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
    }
    .ball{
      width:38px;height:38px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,27,47,.55);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
    }
    .ball.red{border-color:rgba(255,77,77,.35); box-shadow:0 0 0 1px rgba(255,77,77,.08) inset}
    .ball.black{border-color:rgba(220,225,255,.18)}
    .ball.green{border-color:rgba(0,255,153,.35); box-shadow:0 0 0 1px rgba(0,255,153,.10) inset}

    /* Modal */
    .modal{
      display:none;
      position:fixed; inset:0;
      background:rgba(0,0,0,.72);
      backdrop-filter: blur(10px);
      z-index:100;
      padding:18px;
    }
    .modal .box{
      max-width:900px;
      margin:0 auto;
      background:linear-gradient(180deg, rgba(11,18,32,.98), rgba(11,18,32,.86));
      border:1px solid rgba(0,255,255,.16);
      border-radius:18px;
      padding:16px;
      box-shadow:0 24px 70px rgba(0,0,0,.55);
    }
    textarea{
      width:100%;
      background:#0a0f1d;
      color:var(--text);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:12px;
      font-size:14px;
      outline:none;
    }
    .muted{color:var(--muted)}
    .statusBadge{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,27,47,.55);
      font-weight:800;
    }
    .good{color:var(--good)}
    .warn{color:var(--warn)}
    .bad{color:var(--bad)}
  </style>
</head>
<body>
  <header>
    <div class="brand"><span class="dot"></span> Roulette Monitor Pro (PWA)</div>
    <div class="sub">Importe 100 n√∫meros via Google Lens (1¬™ vez). Depois: 1 toque por giro. Diagn√≥stico + Bayes + Setores.</div>
  </header>

  <div class="wrap">
    <section class="card">
      <div class="title"><span class="icon">üé≤</span> Mesas (roletas)</div>
      <div class="row space">
        <div class="tabs" id="tableTabs"></div>
        <div class="row" style="gap:10px;">
          <button class="btn primary" id="newTableBtn">+ Nova mesa</button>
          <button class="btn" id="renameTableBtn">Renomear</button>
          <button class="btn" id="exportBtn">Exportar JSON</button>
          <button class="btn" id="importBtn">Importar JSON</button>
          <button class="btn" id="paste100Btn">üìã Colar 100 n√∫meros</button>
        </div>
      </div>

      <div class="controls">
        <div class="slider">
          <b>Janela:</b> <span id="windowLabel">120</span>
          <input id="windowRange" type="range" min="30" max="500" value="120" />
        </div>
        <div class="slider">
          <b>√öltimos:</b> <span id="lastLabel">12</span>
          <input id="lastRange" type="range" min="6" max="60" value="12" />
        </div>
        <button class="btn" id="undoBtn">Desfazer</button>
        <button class="btn danger" id="clearBtn">Limpar mesa</button>
        <span class="muted">‚ÄúAutom√°tico‚Äù = voc√™ registra o n√∫mero em 1 toque; o app faz o resto.</span>
      </div>
    </section>

    <section class="card">
      <div class="title"><span class="icon">‚ûï</span> Registrar giro (1 toque)</div>
      <div class="row" style="gap:10px;">
        <button class="btn small ghost" data-add="red">Vermelho</button>
        <button class="btn small ghost" data-add="black">Preto</button>
        <button class="btn small ghost" data-add="green">Zero</button>
        <span class="muted">Dica: toque direto no n√∫mero abaixo (0‚Äì36).</span>
      </div>
      <div class="heat" id="quickGrid"></div>
    </section>

    <section class="card">
      <div class="title"><span class="icon">üßæ</span> √öltimos giros</div>
      <div class="lastRow" id="lastRow"></div>
    </section>

    <section class="card">
      <div class="title"><span class="icon">üìä</span> KPIs</div>
      <div class="kpiGrid">
        <div class="kpi">
          <div class="k">Score (0‚Äì100)</div>
          <div class="v" id="scoreVal">-</div>
          <div class="s" id="scoreLabel">‚Äî</div>
        </div>
        <div class="kpi">
          <div class="k">Chi¬≤ (uniformidade)</div>
          <div class="v" id="chiVal">-</div>
          <div class="s">Maior = mais desvio vs uniforme (n√£o garante vi√©s)</div>
        </div>
        <div class="kpi">
          <div class="k">Runs Z (cor)</div>
          <div class="v" id="runsVal">-</div>
          <div class="s">Sequ√™ncias/altern√¢ncia incomuns</div>
        </div>
        <div class="kpi">
          <div class="k">CUSUM Z (regime)</div>
          <div class="v" id="cusumVal">-</div>
          <div class="s">Mudan√ßa de comportamento recente</div>
        </div>
      </div>
      <div style="margin-top:10px">
        <span class="statusBadge">Status: <span id="statusText">‚Äî</span></span>
        <span class="statusBadge">Flags: <span id="flagsText">‚Äî</span></span>
      </div>
    </section>

    <section class="card">
      <div class="title"><span class="icon">üî•</span> Heatmap (freq na janela)</div>
      <div class="heat" id="heatmap"></div>
    </section>

    <section class="card">
      <div class="title"><span class="icon">üß†</span> An√°lises avan√ßadas</div>
      <div class="grid2">
        <div class="kpi">
          <div class="k">G-test</div>
          <div class="v" id="gVal">-</div>
          <div class="s muted">Likelihood ratio (alternativo ao Chi¬≤)</div>
        </div>
        <div class="kpi">
          <div class="k">Entropia</div>
          <div class="v" id="entVal">-</div>
          <div class="s muted">Menor = mais estrutura</div>
        </div>
        <div class="kpi">
          <div class="k">Runs Z (alto/baixo)</div>
          <div class="v" id="runsHLVal">-</div>
          <div class="s muted">19‚Äì36 vs 1‚Äì18</div>
        </div>
        <div class="kpi">
          <div class="k">Autocorrela√ß√£o (m√©dia |lag|)</div>
          <div class="v" id="acVal">-</div>
          <div class="s muted">Depend√™ncia temporal (ideal ~0)</div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="muted" style="font-weight:800;margin-bottom:6px">Top ‚ÄúSetor/Vizinhos‚Äù (wheel EU, janela recente)</div>
        <div class="chips" id="hotChips"></div>
      </div>

      <div style="margin-top:12px">
        <div class="muted" style="font-weight:800;margin-bottom:6px">Sugest√µes de observa√ß√£o (n√£o √© recomenda√ß√£o de aposta)</div>
        <div class="chips" id="suggestChips"></div>
      </div>
    </section>

    <section class="card">
      <div class="title"><span class="icon">‚öôÔ∏è</span> Notas</div>
      <div class="muted">
        Este app n√£o promete ‚Äúentrada certeira‚Äù. Ele mede desvios e mudan√ßas de regime vs aleat√≥rio e organiza informa√ß√µes (freq, runs, setores, Bayes/EWMA).
      </div>
    </section>
  </div>

  <!-- Modal Paste 100 -->
  <div class="modal" id="pasteModal">
    <div class="box">
      <div class="row space">
        <div class="title" style="margin:0;"><span class="icon">üìã</span> Importar 100 n√∫meros (Google Lens)</div>
        <button class="btn" id="closePasteBtn">Fechar</button>
      </div>
      <div class="muted">Cole os 100 n√∫meros. Aceita espa√ßos, v√≠rgulas e quebras de linha. V√°lidos: 0‚Äì36.</div>
      <div style="margin-top:10px">
        <textarea id="pasteArea" rows="7" placeholder="Ex: 16 34 6 19 3 ..."></textarea>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="btn primary" id="confirmPasteBtn">Importar 100</button>
        <button class="btn" id="clearPasteBtn">Limpar</button>
        <span class="muted" id="pasteHint">‚Äî</span>
      </div>
    </div>
  </div>

  <!-- Hidden file input for JSON import -->
  <input type="file" id="importFile" accept="application/json" style="display:none;" />

  <script type="module" src="app.js"></script>
</body>
</html>
